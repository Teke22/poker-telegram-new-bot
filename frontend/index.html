<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Poker Mini App</title>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #0b3d2e;
      color: #ffffff;
      font-family: Arial, sans-serif;
    }

    h1 {
      margin-top: 0;
    }

    button {
      padding: 10px 16px;
      margin: 4px 0;
      border: none;
      border-radius: 6px;
      background: #1e6f5c;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background: #2e8b77;
    }

    input {
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      width: 160px;
    }

    .card {
      background: #124e3a;
      padding: 16px;
      border-radius: 10px;
      margin-top: 16px;
    }

    pre {
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <h1>üÉè Poker Holdem</h1>

  <div class="card" id="user">
    –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...
  </div>

  <div class="card">
    <button onclick="createRoom()">‚ûï –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
    <br><br>

    <input id="code" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã" />
    <br><br>
    <button onclick="joinRoom()">üîë –í–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É</button>
  </div>

  <div class="card">
    <h3>üè† –¢–µ–∫—É—â–∞—è –∫–æ–º–Ω–∞—Ç–∞</h3>
    <pre id="room">‚Äî</pre>
  </div>

  <script>
    /* ---------- Telegram ---------- */
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const user = tg.initDataUnsafe?.user;

    if (user) {
      document.getElementById('user').innerHTML = `
        <b>–ò–≥—Ä–æ–∫:</b> ${user.first_name}<br>
        <b>ID:</b> ${user.id}
      `;
    } else {
      document.getElementById('user').innerText =
        '‚ùå –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram';
    }

    /* ---------- Socket.IO ---------- */
    const socket = io();

    socket.emit('auth', {
      initData: tg.initData
    });

    /* ---------- UI Actions ---------- */
    function createRoom() {
      socket.emit('create_room');
    }

    function joinRoom() {
      const code = document
        .getElementById('code')
        .value
        .trim()
        .toUpperCase();

      if (!code) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã');
        return;
      }

      socket.emit('join_room', code);
    }

    /* ---------- Socket Events ---------- */
    socket.on('room_update', (room) => {
      document.getElementById('room').innerText =
        '–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã: ' + room.code + '\n\n' +
        '–ò–≥—Ä–æ–∫–∏:\n' +
        room.players.map((p, i) => `${i + 1}. ${p.name}`).join('\n');
    });

    socket.on('error_message', (msg) => {
      alert(msg);
    });
  </script>

</body>
</html>
